<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Kalman Filter · AlgebraicInference.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">AlgebraicInference.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">AlgebraicInference.jl</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../regression/">Linear Regression</a></li><li class="is-active"><a class="tocitem" href>Kalman Filter</a></li></ul></li><li><a class="tocitem" href="../../api/">Library Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Kalman Filter</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Kalman Filter</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/samuelsonric/AlgebraicInference.jl/blob/master/docs/literate/kalman.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Kalman-Filter"><a class="docs-heading-anchor" href="#Kalman-Filter">Kalman Filter</a><a id="Kalman-Filter-1"></a><a class="docs-heading-anchor-permalink" href="#Kalman-Filter" title="Permalink"></a></h1><pre><code class="language- hljs">using AlgebraicInference
using BenchmarkTools
using Catlab, Catlab.Graphics, Catlab.Programs, Catlab.WiringDiagrams
using Catlab.WiringDiagrams.MonoidalUndirectedWiringDiagrams: UntypedHypergraphDiagram
using Distributions
using GraphPlot
using LinearAlgebra
using Random</code></pre><p>A Kalman filter with <span>$n$</span> steps is a probability distribution over states <span>$(s_1, \dots, s_n)$</span> and measurements <span>$(z_1, \dots, z_n)$</span> determined by the equations</p><p class="math-container">\[    s_{i+1} \mid s_i \sim \mathcal{N}(As_i, P)\]</p><p>and</p><p class="math-container">\[    z_i \mid s_i \sim \mathcal{N}(Bs_i, Q).\]</p><pre><code class="language-julia hljs">θ = π / 15

A = [
    cos(θ) -sin(θ)
    sin(θ) cos(θ)
]

B = [
    1.3 0.0
    0.0 0.7
]
P = [
    0.05 0.0
    0.0 0.05
]

Q = [
    10.0 0.0
    0.0 10.0
]

function generate_data(n; seed=42)
    Random.seed!(seed)
    x = zeros(2)
    data = Vector{Float64}[]

    for i in 1:n
        x = rand(MvNormal(A * x, P))
        push!(data, rand(MvNormal(B * x, Q)))
    end

    data
end;</code></pre><p>The <em>filtering problem</em> involves predicting the value of the state <span>$s_n$</span> given observations of <span>$(z_1, \dots, z_n)$</span>. The function <code>kalman</code> constructs a wiring diagram that represents the filtering problem.</p><pre><code class="language-julia hljs">function kalman_step(i)
    kf = UntypedHypergraphDiagram{Symbol}(2)
    add_box!(kf, 2; name=:state)
    add_box!(kf, 4; name=:predict)
    add_box!(kf, 4; name=:measure)
    add_box!(kf, 2; name=Symbol(&quot;z$i&quot;))

    add_wires!(kf, [
        (0, 1) =&gt; (2, 3),
        (0, 2) =&gt; (2, 4),
        (1, 1) =&gt; (2, 1),
        (1, 1) =&gt; (3, 1),
        (1, 2) =&gt; (2, 2),
        (1, 2) =&gt; (3, 2),
        (3, 3) =&gt; (4, 1),
        (3, 4) =&gt; (4, 2)])

    kf
end

function kalman(n)
    reduce((kf, i) -&gt; ocompose(kalman_step(i), 1, kf), 2:n; init=kalman_step(1))
end

to_graphviz(kalman(5), box_labels=:name)</code></pre><img src='data:image/svg+xml;utf-8,<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg width="476pt" height="444pt"
 viewBox="0.00 0.00 475.56 443.53" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 439.53)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-439.53 471.56,-439.53 471.56,4 -4,4"/>
<!-- n1 -->
<g id="box1" class="node">
<title>n1</title>
<ellipse fill="none" stroke="black" cx="101.75" cy="-119.21" rx="26.48" ry="18"/>
<text text-anchor="middle" x="101.75" y="-115.51" font-family="Serif" font-size="14.00">state</text>
</g>
<!-- n37 -->
<!-- junction -->
<g id="junction19" class="node">
<title>n37</title>
<ellipse fill="black" stroke="black" cx="123.3" cy="-143.09" rx="2.5" ry="2.5"/>
</g>
<!-- n1&%2345;&%2345;n37 -->
<g id="edge45" class="edge">
<title>n1&%2345;&%2345;n37</title>
<path fill="none" stroke="black" d="M115.76,-134.74C118.08,-137.3 120.18,-139.63 121.57,-141.17"/>
</g>
<!-- n38 -->
<!-- junction -->
<g id="junction20" class="node">
<title>n38</title>
<ellipse fill="black" stroke="black" cx="124.62" cy="-161.38" rx="2.5" ry="2.5"/>
</g>
<!-- n1&%2345;&%2345;n38 -->
<g id="edge48" class="edge">
<title>n1&%2345;&%2345;n38</title>
<path fill="none" stroke="black" d="M111.05,-136.36C115.8,-145.12 121.06,-154.81 123.39,-159.11"/>
</g>
<!-- n2 -->
<g id="box2" class="node">
<title>n2</title>
<ellipse fill="none" stroke="black" cx="164.1" cy="-149.07" rx="35.14" ry="18"/>
<text text-anchor="middle" x="164.1" y="-145.37" font-family="Serif" font-size="14.00">predict</text>
</g>
<!-- n33 -->
<!-- junction -->
<g id="junction15" class="node">
<title>n33</title>
<ellipse fill="black" stroke="black" cx="205.65" cy="-130.59" rx="2.5" ry="2.5"/>
</g>
<!-- n2&%2345;&%2345;n33 -->
<g id="edge35" class="edge">
<title>n2&%2345;&%2345;n33</title>
<path fill="none" stroke="black" d="M191.12,-137.05C196.08,-134.85 200.52,-132.87 203.15,-131.7"/>
</g>
<!-- n34 -->
<!-- junction -->
<g id="junction16" class="node">
<title>n34</title>
<ellipse fill="black" stroke="black" cx="202.16" cy="-141.88" rx="2.5" ry="2.5"/>
</g>
<!-- n2&%2345;&%2345;n34 -->
<g id="edge38" class="edge">
<title>n2&%2345;&%2345;n34</title>
<path fill="none" stroke="black" d="M197.49,-142.76C198.2,-142.62 198.85,-142.5 199.42,-142.39"/>
</g>
<!-- n2&%2345;&%2345;n37 -->
<g id="edge46" class="edge">
<title>n2&%2345;&%2345;n37</title>
<path fill="none" stroke="black" d="M130.04,-144.08C128.4,-143.84 126.99,-143.63 125.88,-143.47"/>
</g>
<!-- n2&%2345;&%2345;n38 -->
<g id="edge49" class="edge">
<title>n2&%2345;&%2345;n38</title>
<path fill="none" stroke="black" d="M133.77,-158.52C131.12,-159.35 128.83,-160.06 127.21,-160.57"/>
</g>
<!-- n3 -->
<g id="box3" class="node">
<title>n3</title>
<ellipse fill="none" stroke="black" cx="86.58" cy="-166.33" rx="41.41" ry="18"/>
<text text-anchor="middle" x="86.58" y="-162.63" font-family="Serif" font-size="14.00">measure</text>
</g>
<!-- n3&%2345;&%2345;n37 -->
<g id="edge47" class="edge">
<title>n3&%2345;&%2345;n37</title>
<path fill="none" stroke="black" d="M110.04,-151.48C114.54,-148.64 118.6,-146.07 121.01,-144.55"/>
</g>
<!-- n3&%2345;&%2345;n38 -->
<g id="edge50" class="edge">
<title>n3&%2345;&%2345;n38</title>
<path fill="none" stroke="black" d="M124.51,-161.39C124.54,-161.39 124.57,-161.38 124.59,-161.38"/>
</g>
<!-- n39 -->
<!-- junction -->
<g id="junction21" class="node">
<title>n39</title>
<ellipse fill="black" stroke="black" cx="55.95" cy="-192.69" rx="2.5" ry="2.5"/>
</g>
<!-- n3&%2345;&%2345;n39 -->
<g id="edge51" class="edge">
<title>n3&%2345;&%2345;n39</title>
<path fill="none" stroke="black" d="M67.71,-182.57C63.77,-185.96 60.16,-189.07 58.01,-190.92"/>
</g>
<!-- n40 -->
<!-- junction -->
<g id="junction22" class="node">
<title>n40</title>
<ellipse fill="black" stroke="black" cx="46.86" cy="-151.94" rx="2.5" ry="2.5"/>
</g>
<!-- n3&%2345;&%2345;n40 -->
<g id="edge53" class="edge">
<title>n3&%2345;&%2345;n40</title>
<path fill="none" stroke="black" d="M54.52,-154.72C52.4,-153.95 50.59,-153.29 49.25,-152.81"/>
</g>
<!-- n4 -->
<g id="box4" class="node">
<title>n4</title>
<ellipse fill="none" stroke="black" cx="18" cy="-178.71" rx="18" ry="18"/>
<text text-anchor="middle" x="18" y="-175.01" font-family="Serif" font-size="14.00">z1</text>
</g>
<!-- n4&%2345;&%2345;n39 -->
<g id="edge52" class="edge">
<title>n4&%2345;&%2345;n39</title>
<path fill="none" stroke="black" d="M35.2,-185.05C42.26,-187.65 49.65,-190.37 53.42,-191.76"/>
</g>
<!-- n4&%2345;&%2345;n40 -->
<g id="edge54" class="edge">
<title>n4&%2345;&%2345;n40</title>
<path fill="none" stroke="black" d="M31.42,-166.27C36.6,-161.46 41.95,-156.49 44.8,-153.86"/>
</g>
<!-- n5 -->
<g id="box5" class="node">
<title>n5</title>
<ellipse fill="none" stroke="black" cx="241.29" cy="-156.15" rx="35.14" ry="18"/>
<text text-anchor="middle" x="241.29" y="-152.45" font-family="Serif" font-size="14.00">predict</text>
</g>
<!-- n29 -->
<!-- junction -->
<g id="junction11" class="node">
<title>n29</title>
<ellipse fill="black" stroke="black" cx="278.52" cy="-172.23" rx="2.5" ry="2.5"/>
</g>
<!-- n5&%2345;&%2345;n29 -->
<g id="edge25" class="edge">
<title>n5&%2345;&%2345;n29</title>
<path fill="none" stroke="black" d="M268.35,-167.83C271.42,-169.16 274.1,-170.32 275.93,-171.11"/>
</g>
<!-- n30 -->
<!-- junction -->
<g id="junction12" class="node">
<title>n30</title>
<ellipse fill="black" stroke="black" cx="285.87" cy="-163.61" rx="2.5" ry="2.5"/>
</g>
<!-- n5&%2345;&%2345;n30 -->
<g id="edge28" class="edge">
<title>n5&%2345;&%2345;n30</title>
<path fill="none" stroke="black" d="M275.08,-161.8C278.38,-162.36 281.22,-162.83 283.16,-163.15"/>
</g>
<!-- n5&%2345;&%2345;n33 -->
<g id="edge36" class="edge">
<title>n5&%2345;&%2345;n33</title>
<path fill="none" stroke="black" d="M220.56,-141.28C215.41,-137.59 210.6,-134.14 207.9,-132.2"/>
</g>
<!-- n5&%2345;&%2345;n34 -->
<g id="edge39" class="edge">
<title>n5&%2345;&%2345;n34</title>
<path fill="none" stroke="black" d="M212.44,-145.63C209.32,-144.49 206.61,-143.5 204.76,-142.83"/>
</g>
<!-- n6 -->
<g id="box6" class="node">
<title>n6</title>
<ellipse fill="none" stroke="black" cx="201.1" cy="-93.24" rx="41.41" ry="18"/>
<text text-anchor="middle" x="201.1" y="-89.54" font-family="Serif" font-size="14.00">measure</text>
</g>
<!-- n6&%2345;&%2345;n33 -->
<g id="edge37" class="edge">
<title>n6&%2345;&%2345;n33</title>
<path fill="none" stroke="black" d="M203.32,-111.48C204.12,-117.99 204.92,-124.58 205.34,-128.06"/>
</g>
<!-- n6&%2345;&%2345;n34 -->
<g id="edge40" class="edge">
<title>n6&%2345;&%2345;n34</title>
<path fill="none" stroke="black" d="M201.49,-111.35C201.72,-121.94 201.99,-134.21 202.1,-139.38"/>
</g>
<!-- n35 -->
<!-- junction -->
<g id="junction17" class="node">
<title>n35</title>
<ellipse fill="black" stroke="black" cx="210.64" cy="-51.5" rx="2.5" ry="2.5"/>
</g>
<!-- n6&%2345;&%2345;n35 -->
<g id="edge41" class="edge">
<title>n6&%2345;&%2345;n35</title>
<path fill="none" stroke="black" d="M205.2,-75.29C207.06,-67.16 209.05,-58.43 210.03,-54.15"/>
</g>
<!-- n36 -->
<!-- junction -->
<g id="junction18" class="node">
<title>n36</title>
<ellipse fill="black" stroke="black" cx="180.55" cy="-56.96" rx="2.5" ry="2.5"/>
</g>
<!-- n6&%2345;&%2345;n36 -->
<g id="edge43" class="edge">
<title>n6&%2345;&%2345;n36</title>
<path fill="none" stroke="black" d="M191.07,-75.53C187.48,-69.2 183.85,-62.8 181.94,-59.41"/>
</g>
<!-- n7 -->
<g id="box7" class="node">
<title>n7</title>
<ellipse fill="none" stroke="black" cx="188.9" cy="-18" rx="18" ry="18"/>
<text text-anchor="middle" x="188.9" y="-14.3" font-family="Serif" font-size="14.00">z2</text>
</g>
<!-- n7&%2345;&%2345;n35 -->
<g id="edge42" class="edge">
<title>n7&%2345;&%2345;n35</title>
<path fill="none" stroke="black" d="M198.75,-33.18C202.7,-39.27 206.84,-45.64 209.04,-49.03"/>
</g>
<!-- n7&%2345;&%2345;n36 -->
<g id="edge44" class="edge">
<title>n7&%2345;&%2345;n36</title>
<path fill="none" stroke="black" d="M185.12,-35.66C183.56,-42.91 181.94,-50.49 181.11,-54.36"/>
</g>
<!-- n8 -->
<g id="box8" class="node">
<title>n8</title>
<ellipse fill="none" stroke="black" cx="304.7" cy="-204.22" rx="35.14" ry="18"/>
<text text-anchor="middle" x="304.7" y="-200.52" font-family="Serif" font-size="14.00">predict</text>
</g>
<!-- n25 -->
<!-- junction -->
<g id="junction7" class="node">
<title>n25</title>
<ellipse fill="black" stroke="black" cx="329.61" cy="-237.31" rx="2.5" ry="2.5"/>
</g>
<!-- n8&%2345;&%2345;n25 -->
<g id="edge15" class="edge">
<title>n8&%2345;&%2345;n25</title>
<path fill="none" stroke="black" d="M317.45,-221.15C321.66,-226.75 325.83,-232.29 328.02,-235.2"/>
</g>
<!-- n26 -->
<!-- junction -->
<g id="junction8" class="node">
<title>n26</title>
<ellipse fill="black" stroke="black" cx="339.67" cy="-231.99" rx="2.5" ry="2.5"/>
</g>
<!-- n8&%2345;&%2345;n26 -->
<g id="edge18" class="edge">
<title>n8&%2345;&%2345;n26</title>
<path fill="none" stroke="black" d="M323.82,-219.4C329.44,-223.86 334.82,-228.14 337.64,-230.37"/>
</g>
<!-- n8&%2345;&%2345;n29 -->
<g id="edge26" class="edge">
<title>n8&%2345;&%2345;n29</title>
<path fill="none" stroke="black" d="M291,-187.47C286.65,-182.15 282.38,-176.94 280.14,-174.2"/>
</g>
<!-- n8&%2345;&%2345;n30 -->
<g id="edge29" class="edge">
<title>n8&%2345;&%2345;n30</title>
<path fill="none" stroke="black" d="M296.39,-186.29C292.76,-178.47 288.92,-170.17 287.04,-166.13"/>
</g>
<!-- n9 -->
<g id="box9" class="node">
<title>n9</title>
<ellipse fill="none" stroke="black" cx="307.03" cy="-132.49" rx="41.41" ry="18"/>
<text text-anchor="middle" x="307.03" y="-128.79" font-family="Serif" font-size="14.00">measure</text>
</g>
<!-- n9&%2345;&%2345;n29 -->
<g id="edge27" class="edge">
<title>n9&%2345;&%2345;n29</title>
<path fill="none" stroke="black" d="M294.44,-150.04C288.84,-157.85 282.88,-166.16 280.11,-170.02"/>
</g>
<!-- n9&%2345;&%2345;n30 -->
<g id="edge30" class="edge">
<title>n9&%2345;&%2345;n30</title>
<path fill="none" stroke="black" d="M295.22,-149.87C292.04,-154.55 289.01,-159 287.3,-161.51"/>
</g>
<!-- n31 -->
<!-- junction -->
<g id="junction13" class="node">
<title>n31</title>
<ellipse fill="black" stroke="black" cx="341.35" cy="-107.08" rx="2.5" ry="2.5"/>
</g>
<!-- n9&%2345;&%2345;n31 -->
<g id="edge31" class="edge">
<title>n9&%2345;&%2345;n31</title>
<path fill="none" stroke="black" d="M328.18,-116.83C332.6,-113.57 336.64,-110.57 339.05,-108.79"/>
</g>
<!-- n32 -->
<!-- junction -->
<g id="junction14" class="node">
<title>n32</title>
<ellipse fill="black" stroke="black" cx="318.36" cy="-91.53" rx="2.5" ry="2.5"/>
</g>
<!-- n9&%2345;&%2345;n32 -->
<g id="edge33" class="edge">
<title>n9&%2345;&%2345;n32</title>
<path fill="none" stroke="black" d="M312.03,-114.41C314.21,-106.52 316.53,-98.16 317.66,-94.07"/>
</g>
<!-- n10 -->
<g id="box10" class="node">
<title>n10</title>
<ellipse fill="none" stroke="black" cx="351.2" cy="-68.13" rx="18" ry="18"/>
<text text-anchor="middle" x="351.2" y="-64.43" font-family="Serif" font-size="14.00">z3</text>
</g>
<!-- n10&%2345;&%2345;n31 -->
<g id="edge32" class="edge">
<title>n10&%2345;&%2345;n31</title>
<path fill="none" stroke="black" d="M346.74,-85.78C344.91,-93.03 342.99,-100.62 342.01,-104.48"/>
</g>
<!-- n10&%2345;&%2345;n32 -->
<g id="edge34" class="edge">
<title>n10&%2345;&%2345;n32</title>
<path fill="none" stroke="black" d="M336.32,-78.73C330.34,-82.99 324.09,-87.45 320.77,-89.81"/>
</g>
<!-- n11 -->
<g id="box11" class="node">
<title>n11</title>
<ellipse fill="none" stroke="black" cx="336.09" cy="-277.14" rx="35.14" ry="18"/>
<text text-anchor="middle" x="336.09" y="-273.44" font-family="Serif" font-size="14.00">predict</text>
</g>
<!-- n21 -->
<!-- junction -->
<g id="junction3" class="node">
<title>n21</title>
<ellipse fill="black" stroke="black" cx="351.51" cy="-317.23" rx="2.5" ry="2.5"/>
</g>
<!-- n11&%2345;&%2345;n21 -->
<g id="edge5" class="edge">
<title>n11&%2345;&%2345;n21</title>
<path fill="none" stroke="black" d="M342.9,-294.84C345.87,-302.56 349.02,-310.75 350.55,-314.75"/>
</g>
<!-- n22 -->
<!-- junction -->
<g id="junction4" class="node">
<title>n22</title>
<ellipse fill="black" stroke="black" cx="339.31" cy="-319.24" rx="2.5" ry="2.5"/>
</g>
<!-- n11&%2345;&%2345;n22 -->
<g id="edge8" class="edge">
<title>n11&%2345;&%2345;n22</title>
<path fill="none" stroke="black" d="M337.48,-295.24C338.11,-303.44 338.78,-312.25 339.11,-316.56"/>
</g>
<!-- n11&%2345;&%2345;n25 -->
<g id="edge16" class="edge">
<title>n11&%2345;&%2345;n25</title>
<path fill="none" stroke="black" d="M333.16,-259.09C331.95,-251.68 330.69,-243.92 330.04,-239.97"/>
</g>
<!-- n11&%2345;&%2345;n26 -->
<g id="edge19" class="edge">
<title>n11&%2345;&%2345;n26</title>
<path fill="none" stroke="black" d="M337.53,-259.03C338.26,-249.81 339.07,-239.55 339.45,-234.75"/>
</g>
<!-- n12 -->
<g id="box12" class="node">
<title>n12</title>
<ellipse fill="none" stroke="black" cx="375.25" cy="-219.98" rx="41.41" ry="18"/>
<text text-anchor="middle" x="375.25" y="-216.28" font-family="Serif" font-size="14.00">measure</text>
</g>
<!-- n12&%2345;&%2345;n25 -->
<g id="edge17" class="edge">
<title>n12&%2345;&%2345;n25</title>
<path fill="none" stroke="black" d="M344.05,-231.83C339.04,-233.73 334.65,-235.39 332.06,-236.38"/>
</g>
<!-- n12&%2345;&%2345;n26 -->
<g id="edge20" class="edge">
<title>n12&%2345;&%2345;n26</title>
<path fill="none" stroke="black" d="M342.46,-231.05C342.35,-231.08 342.25,-231.12 342.14,-231.15"/>
</g>
<!-- n27 -->
<!-- junction -->
<g id="junction9" class="node">
<title>n27</title>
<ellipse fill="black" stroke="black" cx="417.33" cy="-221.04" rx="2.5" ry="2.5"/>
</g>
<!-- n12&%2345;&%2345;n27 -->
<g id="edge21" class="edge">
<title>n12&%2345;&%2345;n27</title>
<path fill="none" stroke="black" d="M416.6,-221.02C416.84,-221.03 417.02,-221.03 417.15,-221.03"/>
</g>
<!-- n28 -->
<!-- junction -->
<g id="junction10" class="node">
<title>n28</title>
<ellipse fill="black" stroke="black" cx="409.32" cy="-193.91" rx="2.5" ry="2.5"/>
</g>
<!-- n12&%2345;&%2345;n28 -->
<g id="edge23" class="edge">
<title>n12&%2345;&%2345;n28</title>
<path fill="none" stroke="black" d="M395.86,-204.22C400.56,-200.61 404.89,-197.3 407.31,-195.45"/>
</g>
<!-- n13 -->
<g id="box13" class="node">
<title>n13</title>
<ellipse fill="none" stroke="black" cx="449.26" cy="-196.38" rx="18" ry="18"/>
<text text-anchor="middle" x="449.26" y="-192.68" font-family="Serif" font-size="14.00">z4</text>
</g>
<!-- n13&%2345;&%2345;n27 -->
<g id="edge22" class="edge">
<title>n13&%2345;&%2345;n27</title>
<path fill="none" stroke="black" d="M434.79,-207.55C428.99,-212.04 422.91,-216.73 419.68,-219.23"/>
</g>
<!-- n13&%2345;&%2345;n28 -->
<g id="edge24" class="edge">
<title>n13&%2345;&%2345;n28</title>
<path fill="none" stroke="black" d="M431.16,-195.26C423.73,-194.8 415.95,-194.32 411.99,-194.08"/>
</g>
<!-- n14 -->
<g id="box14" class="node">
<title>n14</title>
<ellipse fill="none" stroke="black" cx="323.81" cy="-354.43" rx="35.14" ry="18"/>
<text text-anchor="middle" x="323.81" y="-350.73" font-family="Serif" font-size="14.00">predict</text>
</g>
<!-- n19 -->
<!-- junction -->
<g id="junction1" class="node">
<title>n19</title>
<ellipse fill="black" stroke="black" cx="334.73" cy="-395.01" rx="2.5" ry="2.5"/>
</g>
<!-- n14&%2345;&%2345;n19 -->
<g id="edge1" class="edge">
<title>n14&%2345;&%2345;n19</title>
<path fill="none" stroke="black" d="M328.63,-372.35C330.73,-380.16 332.96,-388.45 334.05,-392.5"/>
</g>
<!-- n20 -->
<!-- junction -->
<g id="junction2" class="node">
<title>n20</title>
<ellipse fill="black" stroke="black" cx="289.29" cy="-377.79" rx="2.5" ry="2.5"/>
</g>
<!-- n14&%2345;&%2345;n20 -->
<g id="edge3" class="edge">
<title>n14&%2345;&%2345;n20</title>
<path fill="none" stroke="black" d="M302.54,-368.83C298.1,-371.83 294.03,-374.58 291.61,-376.22"/>
</g>
<!-- n14&%2345;&%2345;n21 -->
<g id="edge6" class="edge">
<title>n14&%2345;&%2345;n21</title>
<path fill="none" stroke="black" d="M336.36,-337.58C341.63,-330.5 347.15,-323.09 349.84,-319.48"/>
</g>
<!-- n14&%2345;&%2345;n22 -->
<g id="edge9" class="edge">
<title>n14&%2345;&%2345;n22</title>
<path fill="none" stroke="black" d="M331.56,-336.84C334.23,-330.79 336.89,-324.74 338.3,-321.55"/>
</g>
<!-- n15 -->
<g id="box15" class="node">
<title>n15</title>
<ellipse fill="none" stroke="black" cx="384.6" cy="-334.39" rx="41.41" ry="18"/>
<text text-anchor="middle" x="384.6" y="-330.69" font-family="Serif" font-size="14.00">measure</text>
</g>
<!-- n15&%2345;&%2345;n21 -->
<g id="edge7" class="edge">
<title>n15&%2345;&%2345;n21</title>
<path fill="none" stroke="black" d="M357.89,-320.54C356.24,-319.69 354.82,-318.95 353.73,-318.39"/>
</g>
<!-- n15&%2345;&%2345;n22 -->
<g id="edge10" class="edge">
<title>n15&%2345;&%2345;n22</title>
<path fill="none" stroke="black" d="M351.69,-323.38C347.52,-321.98 343.94,-320.78 341.72,-320.04"/>
</g>
<!-- n23 -->
<!-- junction -->
<g id="junction5" class="node">
<title>n23</title>
<ellipse fill="black" stroke="black" cx="426.93" cy="-338.66" rx="2.5" ry="2.5"/>
</g>
<!-- n15&%2345;&%2345;n23 -->
<g id="edge11" class="edge">
<title>n15&%2345;&%2345;n23</title>
<path fill="none" stroke="black" d="M424.89,-338.45C425.05,-338.47 425.21,-338.49 425.35,-338.5"/>
</g>
<!-- n24 -->
<!-- junction -->
<g id="junction6" class="node">
<title>n24</title>
<ellipse fill="black" stroke="black" cx="409.95" cy="-367.16" rx="2.5" ry="2.5"/>
</g>
<!-- n15&%2345;&%2345;n24 -->
<g id="edge13" class="edge">
<title>n15&%2345;&%2345;n24</title>
<path fill="none" stroke="black" d="M397.87,-351.54C402.09,-356.99 406.22,-362.33 408.38,-365.13"/>
</g>
<!-- n16 -->
<g id="box16" class="node">
<title>n16</title>
<ellipse fill="none" stroke="black" cx="449.56" cy="-371.39" rx="18" ry="18"/>
<text text-anchor="middle" x="449.56" y="-367.69" font-family="Serif" font-size="14.00">z5</text>
</g>
<!-- n16&%2345;&%2345;n23 -->
<g id="edge12" class="edge">
<title>n16&%2345;&%2345;n23</title>
<path fill="none" stroke="black" d="M439.3,-356.56C435.19,-350.6 430.88,-344.38 428.6,-341.07"/>
</g>
<!-- n16&%2345;&%2345;n24 -->
<g id="edge14" class="edge">
<title>n16&%2345;&%2345;n24</title>
<path fill="none" stroke="black" d="M431.61,-369.47C424.24,-368.68 416.53,-367.86 412.6,-367.44"/>
</g>
<!-- n17 -->
<!-- n17&%2345;&%2345;n19 -->
<g id="edge2" class="edge">
<title>n17&%2345;&%2345;n19</title>
<path fill="none" stroke="black" d="M339.69,-434.33C339.13,-429.93 336.09,-405.86 335.07,-397.71"/>
</g>
<!-- n18 -->
<!-- n18&%2345;&%2345;n20 -->
<g id="edge4" class="edge">
<title>n18&%2345;&%2345;n20</title>
<path fill="none" stroke="black" d="M268.09,-411.27C270.87,-406.9 283.58,-386.81 287.87,-380.03"/>
</g>
</g>
</svg>
'/><p>We generate <span>$100$</span> points of data and solve the filtering problem.</p><pre><code class="language- hljs">n = 100; kf = kalman(n); data = generate_data(n)

box_map = Dict(
    :state =&gt; normal(100I(2)),
    :predict =&gt; kernel(P, A),
    :measure =&gt; kernel(Q, B))

for i in 1:n
    box_map[Symbol(&quot;z$i&quot;)] = normal(data[i])
end

mean(oapply(kf, box_map))</code></pre><pre><code class="language- hljs">@benchmark oapply(kf, box_map)</code></pre><p>Although we can solve the filtering problem using <code>oapply</code>, it is more efficient to use variable elimination. The function <code>inference_problem</code> turns the wiring diagram <code>kf</code> into an undirected graphical model.</p><pre><code class="language- hljs">kb, query = inference_problem(kf, box_map)
pg = primal_graph(kb)

gplot(pg)</code></pre><p>We compute a variable elimination order using the &quot;min-fill&quot; heuristic.</p><pre><code class="language- hljs">order = minfill!(pg, query)
jt = architecture(kb, order)

mean(answer_query(jt, query).box)</code></pre><pre><code class="language- hljs">@benchmark answer_query(jt, query)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../regression/">« Linear Regression</a><a class="docs-footer-nextpage" href="../../api/">Library Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Friday 2 June 2023 22:41">Friday 2 June 2023</span>. Using Julia version 1.9.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
